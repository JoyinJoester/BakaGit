# BakaGit 开发者文档

## 🏗️ 项目架构

### 目录结构
```
BakaGit/
├── src/bakagit/           # 主要源代码
│   ├── __init__.py        # 包初始化
│   ├── main.py           # 应用程序入口
│   ├── core/             # 核心功能模块
│   │   ├── git_manager.py    # Git操作管理
│   │   ├── config.py         # 配置管理
│   │   └── utils.py          # 工具函数
│   └── gui/              # 图形界面模块
│       ├── main_window.py    # 主窗口
│       ├── dialogs/          # 对话框
│       └── widgets/          # 自定义组件
├── docs/                 # 文档
├── tests/                # 测试用例
├── requirements.txt      # 依赖列表
└── README.md            # 项目说明
```

### 技术栈
- **界面框架**：PyQt6 6.9.1
- **Git操作**：GitPython 3.1.45
- **配置管理**：PyYAML 6.0.2
- **Python版本**：3.8+

## 🧩 核心模块

### GitManager (core/git_manager.py)
Git操作的核心类，提供所有Git相关功能。

**主要方法：**
- `load_repository(path)` - 加载Git仓库
- `get_status()` - 获取仓库状态
- `commit(message)` - 提交更改
- `create_branch(name)` - 创建分支
- `switch_branch(name)` - 切换分支
- `push_to_remote()` - 推送到远程
- `pull_from_remote()` - 从远程拉取

**使用示例：**
```python
from bakagit.core.git_manager import GitManager

git_manager = GitManager()
if git_manager.load_repository("/path/to/repo"):
    status = git_manager.get_status()
    print(f"当前分支: {status['current_branch']}")
```

### ConfigManager (core/config.py)
配置管理类，处理应用程序设置的存储和读取。

**主要方法：**
- `get(key, default)` - 获取配置值
- `set(key, value)` - 设置配置值
- `save_config()` - 保存配置到文件
- `load_config()` - 从文件加载配置

**配置文件位置：**
- Windows: `%APPDATA%/BakaGit/config.yaml`
- Linux/Mac: `~/.config/BakaGit/config.yaml`

### MainWindow (gui/main_window.py)
应用程序的主窗口，集成了所有功能界面。

**主要组件：**
- 左侧面板：仓库列表
- 右侧面板：功能标签页
- 菜单栏：主要操作入口
- 状态栏：状态信息显示

## 🎨 界面设计

### 样式系统
BakaGit使用深色主题，提供现代化的用户体验。

**主要颜色：**
- 背景色：`#1e1e1e`
- 前景色：`#ffffff`
- 强调色：`#0078d4`
- 边框色：`#404040`

### 组件规范
- 按钮：圆角8px，最小高度40px
- 列表项：悬停效果，选中高亮
- 输入框：统一的边框和内边距
- 图标：Emoji图标，直观易懂

## 🔧 开发环境搭建

### 环境要求
```bash
Python 3.8+
pip (包管理器)
```

### 安装依赖
```bash
# 安装核心依赖
pip install -r requirements.txt

# 开发依赖（可选）
pip install pytest black flake8
```

### 运行应用
```bash
# 开发模式运行
python -m src.bakagit.main

# 或使用入口脚本
python run.py
```

### 运行测试
```bash
# 运行所有测试
python -m pytest tests/

# 运行特定测试
python tests/test_git_manager.py
```

## 📝 编码规范

### Python代码风格
- 遵循PEP 8规范
- 使用类型提示
- 函数和类都要有文档字符串
- 变量和函数名使用snake_case
- 类名使用PascalCase

### 示例代码
```python
from typing import Optional, List

class ExampleClass:
    """示例类的说明"""
    
    def __init__(self, name: str) -> None:
        """初始化方法
        
        Args:
            name: 名称参数
        """
        self.name = name
    
    def get_items(self, count: Optional[int] = None) -> List[str]:
        """获取项目列表
        
        Args:
            count: 可选的数量限制
            
        Returns:
            项目列表
        """
        # 实现逻辑
        return []
```

### Git提交规范
```
类型(范围): 简短描述

详细描述（可选）

相关问题：#123
```

**提交类型：**
- `feat`: 新功能
- `fix`: 修复bug
- `docs`: 文档更新
- `style`: 代码格式调整
- `refactor`: 重构
- `test`: 测试相关
- `chore`: 构建或辅助工具

## 🧪 测试策略

### 测试结构
```
tests/
├── test_git_manager.py      # Git操作测试
├── test_config.py           # 配置管理测试
├── test_main_window.py      # 界面功能测试
└── fixtures/                # 测试数据
```

### 测试用例编写
```python
import pytest
from bakagit.core.git_manager import GitManager

class TestGitManager:
    """GitManager测试类"""
    
    def setup_method(self):
        """每个测试方法前的设置"""
        self.git_manager = GitManager()
    
    def test_load_repository_success(self):
        """测试成功加载仓库"""
        # 测试逻辑
        assert True
    
    def test_load_repository_failure(self):
        """测试加载仓库失败"""
        # 测试逻辑
        assert True
```

### 测试覆盖率
目标达到80%以上的代码覆盖率。使用pytest-cov生成覆盖率报告：

```bash
pip install pytest-cov
pytest --cov=src/bakagit tests/
```

## 🚀 构建和发布

### 打包应用
```bash
# 安装打包工具
pip install pyinstaller

# 创建可执行文件
pyinstaller --onefile --windowed src/bakagit/main.py
```

### 版本管理
版本号格式：`主版本.次版本.修订版本`

更新版本：
1. 修改`src/bakagit/__init__.py`中的`__version__`
2. 更新`README.md`中的版本信息
3. 创建Git标签：`git tag v1.0.0`

### 发布清单
- [ ] 运行所有测试
- [ ] 更新版本号
- [ ] 更新文档
- [ ] 创建发布包
- [ ] 创建Git标签
- [ ] 发布到GitHub

## 🐛 调试技巧

### 日志系统
BakaGit使用Python的logging模块进行日志记录。

```python
import logging

# 配置日志
logging.basicConfig(
    level=logging.DEBUG,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'
)

logger = logging.getLogger(__name__)
logger.debug("调试信息")
```

### 常见问题
1. **PyQt6导入错误**：确保正确安装PyQt6
2. **Git命令失败**：检查Git是否在PATH中
3. **配置文件问题**：检查配置文件格式和权限

### 调试工具
- **PyQt6调试**：使用`QApplication.exec_()`的返回值
- **Git操作调试**：查看GitPython的异常信息
- **界面调试**：使用Qt Designer查看界面结构

## 🤝 贡献指南

### 贡献流程
1. Fork项目
2. 创建功能分支：`git checkout -b feature/新功能`
3. 提交更改：`git commit -m "feat: 添加新功能"`
4. 推送分支：`git push origin feature/新功能`
5. 创建Pull Request

### 代码审查
- 确保代码符合项目规范
- 添加必要的测试用例
- 更新相关文档
- 通过所有CI检查

### 问题报告
使用GitHub Issues报告bug或请求功能：
- 提供详细的重现步骤
- 包含错误信息和日志
- 说明预期行为和实际行为
- 提供系统环境信息

## 📚 扩展开发

### 添加新功能
1. 在`core/`中添加核心逻辑
2. 在`gui/`中添加界面组件
3. 在主窗口中集成功能
4. 添加相应的测试用例
5. 更新文档

### 插件系统（计划中）
未来版本将支持插件系统，允许开发者扩展BakaGit的功能。

### API文档
详细的API文档将在未来版本中提供，包括所有公共接口的说明。

---

**欢迎参与BakaGit的开发！** 任何贡献都是宝贵的。
